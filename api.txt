<?php
// Evento storico dall'API Ninjas
$anno = 1969; 
$limite = 1; 
$url_eventi = "https://api.api-ninjas.com/v1/historicalevents?year=" . $anno . "&limit=" . $limite;

$ch = curl_init($url_eventi);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, array(
    'X-Api-Key: LA_TUA_CHIAVE_API'
));
$risposta_eventi = curl_exec($ch);

if(curl_errno($ch)) {
    die('Errore nella richiesta eventi: ' . curl_error($ch));
}

$eventi = json_decode($risposta_eventi, true);
curl_close($ch);

if (!empty($eventi)) {
    $evento = $eventi[0]['event']; // Primo evento
    echo "Evento selezionato: $evento\n";

    // Generare immagine con DALL·E
    $url_image = "https://api.openai.com/v1/images/generations";

    $data = array(
        "prompt" => $evento, // Prompt basato sull'evento
        "n" => 1,
        "size" => "1024x1024"
    );

    $ch_img = curl_init($url_image);
    curl_setopt($ch_img, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch_img, CURLOPT_POST, true);
    curl_setopt($ch_img, CURLOPT_HTTPHEADER, array(
        'Authorization: Bearer LA_TUA_CHIAVE_API_OPENAI', // Sostituisci con la tua chiave API OpenAI
        'Content-Type: application/json'
    ));
    curl_setopt($ch_img, CURLOPT_POSTFIELDS, json_encode($data));

    $risposta_img = curl_exec($ch_img);

    if(curl_errno($ch_img)) {
        die('Errore nella richiesta immagine: ' . curl_error($ch_img));
    }

    $immagine = json_decode($risposta_img, true);
    curl_close($ch_img);

    if (!empty($immagine['data'])) {
        $url_immagine = $immagine['data'][0]['url'];
        echo "Immagine generata: $url_immagine\n";
    } else {
        echo "Nessuna immagine generata.";
    }
} else {
    echo "Nessun evento trovato per l'anno $anno.";
}
?>